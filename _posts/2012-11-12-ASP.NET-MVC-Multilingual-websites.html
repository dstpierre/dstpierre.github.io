---
layout: post
title: ASP.NET MVC Multilingual websites
date: 2012-11-12 16:37:50 UTC
updated: 2012-11-12 16:37:50 UTC
comments: false
categories: ASP.NET MVC
---

<p>I used to have a series of posts on how to achieve a functional multilingual website, unfortunately it has been lost. Here is a single to the point post on the subject, including how I did JavaScript translation when I was running Bunker App.</p> <h3>The database</h3> <p>It might look simple at first to just add a new column on your tables containing the language or culture for the data. But it’s actually a little bit bigger. It’s normally a little of the columns that needs to be translated, so you often have to split your tables. An example:</p> <h4>Website content page</h4> <p>You might have the '”master” data like who created the page, the date of creation and last modification etc. Those meta information does not need to be translated. The page title, URL and the page body content on the other hand needs to be translated. You might end up with the following tables layout:</p> <table border="0" cellspacing="2" cellpadding="2" width="500"> <tbody> <tr> <td valign="top" width="250"><strong>Pages</strong></td> <td valign="top" width="250"><strong>PageContent</strong></td></tr> <tr> <td valign="top" width="250">Id<br>ParentId<br>CreatedBy<br>Created<br>ModifiedBy<br>Modified</td> <td valign="top" width="250">Id<br>PageId<br>Culture<br>URL<br>Title<br>Body</td></tr></tbody></table> <p>That way you can have 2 or 20 translated version of a page without repeating the non-translated information. You might also consider adding an index to the Culture field since you would probably have lots of filtering by that field.</p> <h3>MVC multilingual routes</h3> <p>I’m usually using the simple {lang} parameter to differentiate the route in a website with multiple language supported.</p><pre class="csharpcode">routes.MapRoute(<br />  name: <span class="str">"ML"</span>,<br />  url: <span class="str">"{lang}/{controller}/{action}/{id}"</span>,<br />  defaults: <span class="kwrd">new</span> { lang = <span class="str">"en"</span>, controller = <span class="str">"Pages"</span>, action = <span class="str">"Show"</span>, id = UrlParameter.Optional }<br />);</pre><br /><h4>You have a base controller right?</h4><br /><p>On a base controller class you might override the <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.controller.onactionexecuting(v=vs.98).aspx" target="_blank">OnActionExecuting</a> and grab the requested language, set the current thread’s <a href="http://msdn.microsoft.com/en-us/library/system.threading.thread.currentculture.aspx" target="_blank">CurrentCulture</a> and <a href="http://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture.aspx" target="_blank">CurrentUICulture</a> appropriately: </p><pre class="csharpcode"><span class="kwrd">protected</span> <span class="kwrd">string</span> Language { get; set; }<br /><br /><span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnActionExecuting(ActionExecutingContext filterContext)<br />{<br />  <span class="kwrd">base</span>.OnActionExecuting(filterContext);<br /><br />  <span class="kwrd">if</span> (filterContext.RouteData.Values.ContainsKey(<span class="str">"lang"</span>))<br />    Language = filterContext.RouteData.Values[<span class="str">"lang"</span>].ToString().ToLower();<br />  <span class="kwrd">else</span><br />    Language = <span class="str">"en"</span>;<br /><br />  ViewBag.language = Language;<br /><br />  Thread.CurrentThread.CurrentCulture = <span class="kwrd">new</span> CultureInfo(Language);<br />  Thread.CurrentThread.CurrentUICulture = <span class="kwrd">new</span> CultureInfo(Language);<br />}</pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>Now you have the Language property pointing to the requested culture (i.e. en-US / fr-CA, etc) and on the ViewBag.language dynamic property to use on your views.</p><br /><h3>Querying data</h3><br /><p>No matter how you proceed to query any data from your data store you will simply need the Language property from your controller to get the desired data filtered in the right culture.</p><br /><div class="csharpcode"><pre><span class="lnum">   1:  </span><span class="kwrd">public</span> PageController : BaseController</pre><pre><span class="lnum">   2:  </span>{</pre><pre><span class="lnum">   3:  </span>  <span class="kwrd">private</span> IPageRepository pages = <span class="kwrd">null</span>;</pre><pre><span class="lnum">   4:  </span>&nbsp;</pre><pre><span class="lnum">   5:  </span>  <span class="kwrd">public</span> PageController() : <span class="kwrd">this</span>(<span class="kwrd">new</span> SqlPageRepository()) { }</pre><pre><span class="lnum">   6:  </span>&nbsp;</pre><pre><span class="lnum">   7:  </span>  <span class="kwrd">public</span> PageController(IPageRepository repo)</pre><pre><span class="lnum">   8:  </span>  {</pre><pre><span class="lnum">   9:  </span>    pages = repo;</pre><pre><span class="lnum">  10:  </span>  }</pre><pre><span class="lnum">  11:  </span>&nbsp;</pre><pre><span class="lnum">  12:  </span>  <span class="kwrd">public</span> ActionResult Show(<span class="kwrd">string</span> id)</pre><pre><span class="lnum">  13:  </span>  {</pre><pre><span class="lnum">  14:  </span>    var vm = pages.Get(id, Language);</pre><pre><span class="lnum">  15:  </span>    <span class="kwrd">return</span> View(vm);</pre><pre><span class="lnum">  16:  </span>   }</pre><pre><span class="lnum">  17:  </span>}<style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style></pre></div><br /><p>On line 1 by inheriting from the BaseController the Language property will be set the the requested culture, then on line 14 we can see that we can pull the right data from the data store.</p><br /><h3>One view to rule them all</h3><br /><p>You do not need multiple views per language supported. That option would not scale right and would have lots of overhead. On a view you can easily have the following elements properly translated:</p><br /><h4>The text</h4><br /><p>This is the easiest part. The <a href="http://msdn.microsoft.com/en-us/library/7zxb70x7(v=vs.80).aspx" target="_blank">Resource Files</a> are very handy for that situation. I used two approach in the past.</p><br /><p><strong>For simple website, global resource files</strong></p><br /><p>If you have a website that is not too big in number of pages needed to be translated, you might want to use the easy way. Add the App_GlobalResources to your project and put one or more file there with translation.</p><br /><p>Home.resx | Home.fr.resx | Home.es.resx</p><br /><p>The fail over file “Home.resx” is the one with your default language and the one that will be used for a specific resource value if the key does not exists on the language file.</p><br /><p>I find it easier to create a website with only the default file involved, and once the site gets to the v1 release I copy the file to the other supported languages. That way it prevent from having to manually maintain files while you constantly add new keys to the main file.</p><br /><p>To get a value from a view you simply use that syntax:</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">h1</span><span class="kwrd">&gt;</span>@Resources.Home.Title<span class="kwrd">&lt;/</span><span class="html">h1</span><span class="kwrd">&gt;</span></pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>Once all your website if fine in your default language you can start translating to other languages. It’s easy enough to send the .RESX files to professional translator.</p><br /><p><strong>For larger website, use local resource files</strong></p><br /><p>Sometime things get out of control when you start to have too much global resource files. You might want to use local resource files on each of your views subfolder.</p><br /><h4>Images</h4><br /><p>My approach for handling images on your views in simple enough. Ask the designer to maximize images without text. For images that need to have text on it, I simply ask the designer to create multiple file like image-name-en-US.png, image-name-fr-CA.png, image-name-es-ES.png.</p><br /><p>From your views you already have the proper culture on the ViewBag.language property, so it’s simple enough to get the right image like this:</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">img</span> <span class="attr">src</span><span class="kwrd">="/images/image-name-@(ViewBag.language).png"</span> <span class="attr">alt</span><span class="kwrd">="@Resources.Home.ImageNameAlt"</span> <span class="kwrd">/&gt;</span></pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>You just have to make sure every images has the same naming convention. Also, if you need to set different height and with for different culture, you can still use the resource files for that, like I did for the alt attribute.</p><br /><h4>Multilingual JavaScript</h4><br /><p>Ho boy! First of all I’m not really what we could call a JavaScript expert, even not a JS ultra knowledgeable person. But I come to really love the language over time and here is what I did to have a functional multilingual one page JavaScript app when I was the owner of Bunker App.</p><br /><p>I tried to replicate what resource files was to the .NET world and simply created one JS file per culture containing a dictionary of translated value. Here is a simple example:</p><pre class="csharpcode"><span class="rem">// languagepack-en.js</span><br /><span class="kwrd">var</span> Lang = {<br />  globalDateFormat = <span class="str">'mm-dd-yy'</span>;<br />  greeting: <span class="str">'Hello'</span>  <br />};<br /><br /><span class="rem">// languagepack-fr.js</span><br /><span class="kwrd">var</span> Lang = {<br />  globalDateFormat = <span class="str">'yy-mm-dd'</span>;<br />  greeting: <span class="str">'Bonjour'</span>  <br />};</pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>Just create an object containing the key and value of the text you are using on your JavaScript scripts. You can use this like this:</p><pre class="csharpcode">alert(Lang.greeting + <span class="str">' '</span> + userName);</pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>You only need to include the right language pack file before your scripts, like this:</p><pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">script</span> <span class="attr">language</span><span class="kwrd">="javascript"</span> <span class="attr">type</span><span class="kwrd">="text/javascript"</span> <span class="attr">src</span><span class="kwrd">="/content/js/langpack-@(ViewBag.language.SubString(0, 2)).js"</span><span class="kwrd">&gt;&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span><br /><br />&lt;script language=<span class="str">"javascript"</span> type=<span class="str">"text/javascript"</span> src=<span class="str">"/content/js/yourscript.js"</span>&gt;<span class="kwrd">&lt;/</span><span class="html">script</span><span class="kwrd">&gt;</span></pre><br /><style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style><br /><br /><p>We only use the left two character of the culture, because you might not have multiple JS file for English and French for different countries. But you can if you want.</p><br /><h3>This is just my way of doing this</h3><br /><p>Since we have two official language here in Quebec (French and English) almost every site I've built required to be at least support those two language. I have been successful using those technique, but I’m not implying in any way that this is the only or a good approach to use.</p><br /><p>Even though having a multilingual website appear to be simple at first, it clearly add lots of gotcha and things to think a bit. But in the end it’s not so bad to implement. </p><br /><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:137a55d6-d094-44ba-9013-95d007128606" class="wlWriterEditableSmartContent">Technorati Tags: <a href="http://technorati.com/tags/Multilingual+website" rel="tag">Multilingual website</a>,<a href="http://technorati.com/tags/ASP.NET+MVC" rel="tag">ASP.NET MVC</a>,<a href="http://technorati.com/tags/Multilingual+JavaScript" rel="tag">Multilingual JavaScript</a></div>  